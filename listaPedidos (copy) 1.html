<!doctype html>
<html>
  <head>
    <title>Lista de Pedidos</title>
    <link rel="stylesheet" href="style3.css" />
    <style>

      div{
        position: fixed; /* Fixar a div no topo da tela */
        top: 0; /* Posicionar no topo */
        width: 100%; /* Ocupar toda a largura da tela */
        background-color: #fff; /* Cor de fundo branca (opcional) */
        padding: 20px; /* Espaçamento interno (opcional) */
        z-index: 10; /* Garantir que fique acima de outros elementos */
      }
      
      table {
        border-collapse: collapse;
        width: 100%;
      }
      
      th,
      td {
        border: 1px solid black;
        padding: 8px;
        text-align: left;
      }
    </style>
  </head>
  <body>
    <div>
    <h1>Lista de Pedidos</h1>
    <br>
    <a href="/logado">Voltar</a>
    <br>
    <br>
    <table id="pedidoTable">
      <thead>
        <tr>
          <th>Nome</th>
          <th>Itens do Pedido</th>
          <th>Observação</th>
          <th>Data e Hora</th>
        </tr>
      </thead>
      <tbody>
        <!-- Pedidos serão inseridos aqui -->
      </tbody>
    </table>
      </div>

    <!-- <script defer>
      // Lê o arquivo JSON usando fetch
      fetch("datapedido.json")
        .then((response) => response.json())
        .then((pedidos) => {
          // Ordena os pedidos por data e hora (do mais antigo para o mais novo)
          pedidos.sort((a, b) => new Date(a.dataHora) - new Date(b.dataHora));

          // Seleciona a tabela pelo ID
          const tableBody = document
            .getElementById("pedidoTable")
            .getElementsByTagName("tbody")[0];

          // Adiciona cada pedido como uma linha na tabela
          pedidos.forEach((pedido) => {
            const row = tableBody.insertRow();
            const nomeCell = row.insertCell();
            const itensCell = row.insertCell();
            const obsCell = row.insertCell();
            const dataHoraCell = row.insertCell();

            nomeCell.textContent = pedido.nome;
            itensCell.textContent = pedido.pedidoItens;
            obsCell.textContent = pedido.observacao;
            dataHoraCell.textContent = new Date(
              pedido.dataHora,
            ).toLocaleString(); // Formata a data e hora
          });
        })
        .catch((error) => {
          console.error("Erro ao carregar os pedidos:", error);
        });
    </script> -->

    <script defer>
      function apagarPedidosAntigos(pedidos) {
        const hoje = new Date();
        hoje.setHours(0, 0, 0, 0); // Define a hora para o início do dia de hoje

        // Filtra os pedidos, mantendo apenas os do dia atual
        const pedidosAtuais = pedidos.filter((pedido) => {
          const dataPedido = new Date(pedido.dataHora);
          return dataPedido >= hoje;
        });

        return pedidosAtuais;
      }

      // Lê o arquivo JSON usando fetch
      fetch("datapedido.json")
        .then((response) => response.json())
        .then((pedidos) => {
          // Apaga pedidos antigos (do dia anterior)
          const pedidosFiltrados = apagarPedidosAntigos(pedidos);

          // Ordena os pedidos por data e hora (do mais antigo para o mais novo)
          pedidosFiltrados.sort(
            (a, b) => new Date(a.dataHora) - new Date(b.dataHora),
          );

          // Seleciona a tabela pelo ID
          const tableBody = document
            .getElementById("pedidoTable")
            .getElementsByTagName("tbody")[0];

          // Adiciona cada pedido como uma linha na tabela
          pedidosFiltrados.forEach((pedido) => {
            const row = tableBody.insertRow();
            const nomeCell = row.insertCell();
            const itensCell = row.insertCell();
            const obsCell = row.insertCell();
            const dataHoraCell = row.insertCell();

            nomeCell.textContent = pedido.nome;
            itensCell.textContent = pedido.pedidoItens;
            obsCell.textContent = pedido.observacao;
            dataHoraCell.textContent = new Date(
              pedido.dataHora,
            ).toLocaleString(); // Formata a data e hora
          });
        })
        .catch((error) => {
          console.error("Erro ao carregar os pedidos:", error);
        });
    </script>
  </body>
</html>
